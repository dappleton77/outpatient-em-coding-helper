<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outpatient E/M Coding Helper</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            max-width: 900px;
            margin: auto;
            padding: 20px;
            background-color: #f4f7fa;
            color: #333;
        }

        h1, h2, h3 {
            color: #2c3e50;
        }

        .step {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: none;
        }

        .step.active {
            display: block;
        }

        label, input, select {
            display: block;
            margin-bottom: 10px;
        }

        input[type="radio"], input[type="checkbox"] {
            display: inline;
            margin-right: 10px;
        }

        button {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }

        button:hover {
            background-color: #219653;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        #result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f5e9;
            border-left: 5px solid #27ae60;
            border-radius: 5px;
            font-size: 16px;
            display: none;
        }

        .examples {
            font-size: 0.9em;
            color: #555;
            margin-left: 20px;
        }

        footer {
            margin-top: 40px;
            text-align: center;
            color: #777;
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }

        /* Accessibility improvements */
        :focus {
            outline: 2px solid #27ae60;
        }

        /* Responsive design */
        @media (max-width: 600px) {
            body {
                max-width: 100%;
                padding: 10px;
            }
            .step {
                padding: 15px;
            }
            button {
                width: 100%;
                margin-bottom: 10px;
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <h1>Outpatient E/M Coding Helper</h1>
    <p>This tool guides you through assessing MDM for new (99202-99205) or established (99212-99215) outpatient visits. Click through the steps.</p>
    
    <div id="step1" class="step active" aria-labelledby="step1-heading">
        <h2 id="step1-heading">Step 1: Visit Type</h2>
        <label for="visitType">Select the type of visit:</label>
        <select id="visitType" aria-describedby="visitType-desc">
            <option value="new">New (99202-99205)</option>
            <option value="established">Established (99212-99215)</option>
        </select>
        <p id="visitType-desc" class="sr-only">Choose between new or established patient visit.</p>
        <button onclick="nextStep(1)">Next</button>
    </div>
    
    <div id="step2" class="step" aria-labelledby="step2-heading">
        <h2 id="step2-heading">Step 2: Number and Complexity of Problems Addressed</h2>
        <p>Select the option that best matches your encounter. Examples are provided for each level, focusing on cardiovascular disease evaluation and management.</p>
        <div role="radiogroup" aria-labelledby="step2-heading">
            <input type="radio" name="problems" value="minimal" id="problemsMinimal">
            <label for="problemsMinimal">Minimal Level</label>
            <div class="examples">
                - 1 self-limited or minor problem (e.g., transient palpitations resolved without intervention)
            </div>
            
            <input type="radio" name="problems" value="low" id="problemsLow">
            <label for="problemsLow">Low Level</label>
            <div class="examples">
                - 2+ self-limited/minor problems<br>
                - Or 1 stable chronic illness (e.g., stable hypertension controlled with current regimen)<br>
                - Or 1 acute, uncomplicated illness/injury (e.g., mild chest pain with negative workup)
            </div>
            
            <input type="radio" name="problems" value="moderate" id="problemsModerate">
            <label for="problemsModerate">Moderate Level</label>
            <div class="examples">
                - 1+ chronic illnesses with exacerbation/progression/side effects (e.g., worsening angina requiring medication adjustment)<br>
                - Or 2+ stable chronic illnesses (e.g., coronary artery disease and hypertension, both managed)<br>
                - Or 1 undiagnosed new problem with uncertain prognosis (e.g., new onset shortness of breath of unclear etiology)<br>
                - Or 1 acute illness with systemic symptoms (e.g., atrial fibrillation with rapid ventricular response)<br>
                - Or 1 acute complicated injury (e.g., chest trauma in patient on anticoagulants)
            </div>
            
            <input type="radio" name="problems" value="high" id="problemsHigh">
            <label for="problemsHigh">High Level</label>
            <div class="examples">
                - 1+ chronic illnesses with severe exacerbation/progression/side effects (e.g., acute decompensated heart failure)<br>
                - Or 1 acute/chronic illness/injury threatening life or function (e.g., acute myocardial infarction or unstable arrhythmia)
            </div>
        </div>
        <p id="problems-error" class="error-message">Please select an option to proceed.</p>
        <button onclick="prevStep(2)">Back</button>
        <button id="next2" onclick="nextStep(2)" disabled>Next</button>
    </div>
    
    <div id="step3" class="step" aria-labelledby="step3-heading">
        <h2 id="step3-heading">Step 3: Amount and/or Complexity of Data Reviewed and Analyzed</h2>
        <p>Check all that apply. The level will be determined based on categories met.</p>
        
        <h3>Category 1: Tests, Notes, and Historian</h3>
        <label for="dataReviewExternal">
            <input type="checkbox" id="dataReviewExternal"> Review of external notes from unique source
        </label>
        <label for="dataReviewTests">
            <input type="checkbox" id="dataReviewTests"> Review of unique test results
        </label>
        <label for="dataOrderTests">
            <input type="checkbox" id="dataOrderTests"> Ordering of unique tests
        </label>
        <label for="dataHistorian">
            <input type="checkbox" id="dataHistorian"> Assessment requiring independent historian (e.g., family input)
        </label>
        
        <h3>Category 2: Independent Interpretation</h3>
        <label for="dataInterpretation">
            <input type="checkbox" id="dataInterpretation"> Independent interpretation of tests not separately reported (e.g., personally reviewing an ECG)
        </label>
        
        <h3>Category 3: Discussion</h3>
        <label for="dataDiscussion">
            <input type="checkbox" id="dataDiscussion"> Discussion with external provider/source (e.g., consulting cardiologist)
        </label>
        
        <p><em>Levels:</em><br>
        - Minimal: None or minimal data<br>
        - Low: Limited (e.g., any 2 from tests/documents or independent historian)<br>
        - Moderate: Moderate (e.g., any 3 from Category 1, or Category 2, or Category 3)<br>
        - High: Extensive (meet 2 of 3 categories)
        </p>
        
        <button onclick="prevStep(3)">Back</button>
        <button onclick="nextStep(3)">Next</button>
    </div>
    
    <div id="step4" class="step" aria-labelledby="step4-heading">
        <h2 id="step4-heading">Step 4: Risk of Complications and/or Morbidity or Mortality</h2>
        <p>Select the option that best matches. Examples included, focusing on cardiovascular disease evaluation and management.</p>
        <div role="radiogroup" aria-labelledby="step4-heading">
            <input type="radio" name="risk" value="minimal" id="riskMinimal">
            <label for="riskMinimal">Minimal Level</label>
            <div class="examples">
                - Minimal (e.g., rest, superficial dressings)
            </div>
            
            <input type="radio" name="risk" value="low" id="riskLow">
            <label for="riskLow">Low Level</label>
            <div class="examples">
                - Low (e.g., over-the-counter meds like aspirin for mild symptoms, physical therapy for cardiac rehab)
            </div>
            
            <input type="radio" name="risk" value="moderate" id="riskModerate">
            <label for="riskModerate">Moderate Level</label>
            <div class="examples">
                - Prescription drug management (e.g., adjusting statins or beta-blockers for hypertension)<br>
                - Decision for minor surgery with risk factors (e.g., cardiac catheterization in patient with comorbidities)<br>
                - Elective major surgery without risk factors (e.g., planning coronary bypass in stable patient)<br>
                - Treatment limited by social determinants (e.g., non-adherence due to access issues in heart failure management)
            </div>
            
            <input type="radio" name="risk" value="high" id="riskHigh">
            <label for="riskHigh">High Level</label>
            <div class="examples">
                - Drug therapy needing intensive monitoring (e.g., IV anticoagulants for acute coronary syndrome)<br>
                - Elective major surgery with risk factors (e.g., valve repair in high-risk elderly patient)<br>
                - Emergency major surgery (e.g., urgent angioplasty for STEMI)<br>
                - Decision to hospitalize/escalate care (e.g., admission for unstable angina)<br>
                - Decision not to resuscitate/de-escalate due to poor prognosis (e.g., advanced heart failure)
            </div>
        </div>
        <p id="risk-error" class="error-message">Please select an option to proceed.</p>
        <button onclick="prevStep(4)">Back</button>
        <button id="next4" onclick="nextStep(4)" disabled>Next</button>
    </div>
    
    <div id="step5" class="step" aria-labelledby="step5-heading">
        <h2 id="step5-heading">Step 5: Time Override (Optional)</h2>
        <p>If using time instead of (or in addition to) MDM, enter total minutes spent on the date of encounter (includes chart review, counseling, etc.).</p>
        <label for="time">Total minutes (e.g., 60):</label>
        <input type="number" id="time" min="0" aria-describedby="time-desc time-error">
        <p id="time-desc"><em>Thresholds:</em><br>
        - New: Level 1 ≥15 min, Level 2 ≥30 min, Level 3 ≥45 min, Level 4 ≥60 min<br>
        - Established: Level 1 ≥10 min, Level 2 ≥20 min, Level 3 ≥30 min, Level 4 ≥40 min
        </p>
        <p id="time-error" class="error-message">Please enter a valid non-negative number.</p>
        
        <button onclick="prevStep(5)">Back</button>
        <button onclick="calculateLevel()">Calculate Level</button>
    </div>
    
    <div id="result" aria-live="polite"></div>
    
    <button id="resetButton" onclick="resetForm()" style="display: none; background-color: #e74c3c; margin-top: 20px;">Reset and Start Over</button>
    
    <footer>
        <p>This is an educational tool only. Consult official guidelines and your billing team.</p>
        <p>For full details: <a href="https://www.ama-assn.org/system/files/2023-e-m-descriptors-guidelines.pdf">AMA Guidelines</a> | <a href="https://www.aan.com/siteassets/home-page/tools-and-resources/practicing-neurologist--administrators/billing-and-coding/cpt--em/2023-cpt-revised-mdm-grid.pdf">MDM Grid</a></p>
    </footer>
    
    <script>
        // Configuration object for easy updates
        const CONFIG = {
            newPatientTimes: [15, 30, 45, 60],
            establishedPatientTimes: [10, 20, 30, 40],
            codes: {
                new: ['', '99202', '99203', '99204', '99205'],
                established: ['', '99212', '99213', '99214', '99215']
            },
            levelDescriptions: ['Straightforward', 'Low', 'Moderate', 'High']
        };

        // Show error messages when Next is disabled
        function showError(id, show) {
            document.getElementById(id).style.display = show ? 'block' : 'none';
        }

        function nextStep(current) {
            let canProceed = true;
            if (current === 2) {
                canProceed = !!document.querySelector('input[name="problems"]:checked');
                showError('problems-error', !canProceed);
            }
            if (current === 4) {
                canProceed = !!document.querySelector('input[name="risk"]:checked');
                showError('risk-error', !canProceed);
            }
            if (!canProceed) return;
            
            document.getElementById(`step${current}`).classList.remove('active');
            document.getElementById(`step${current + 1}`).classList.add('active');
        }

        function prevStep(current) {
            document.getElementById(`step${current}`).classList.remove('active');
            document.getElementById(`step${current - 1}`).classList.add('active');
        }

        // Enable Next buttons when selections made
        document.querySelectorAll('input[name="problems"]').forEach(input => {
            input.addEventListener('change', () => {
                document.getElementById('next2').disabled = false;
                showError('problems-error', false);
            });
        });
        document.querySelectorAll('input[name="risk"]').forEach(input => {
            input.addEventListener('change', () => {
                document.getElementById('next4').disabled = false;
                showError('risk-error', false);
            });
        });

        // Validate time input
        function validateTime(timeValue) {
            const time = parseInt(timeValue, 10);
            if (isNaN(time) || time < 0) {
                showError('time-error', true);
                return 0;
            }
            showError('time-error', false);
            return time;
        }

        // Calculate data level
        function calculateDataLevel() {
            const external = document.getElementById('dataReviewExternal').checked;
            const reviewTests = document.getElementById('dataReviewTests').checked;
            const orderTests = document.getElementById('dataOrderTests').checked;
            const historian = document.getElementById('dataHistorian').checked;
            const interp = document.getElementById('dataInterpretation').checked;
            const discussion = document.getElementById('dataDiscussion').checked;
            
            const cat1_low = (external ? 1 : 0) + (reviewTests ? 1 : 0) + (orderTests ? 1 : 0);
            const isLow = (cat1_low >= 2) || historian;
            
            const cat1_mod = cat1_low + (historian ? 1 : 0);
            const isModerate = (cat1_mod >= 3) || interp || discussion;
            
            const categoriesMet = (cat1_mod >= 3 ? 1 : 0) + (interp ? 1 : 0) + (discussion ? 1 : 0);
            const isHigh = categoriesMet >= 2;
            
            return {
                level: isHigh ? 'high' : isModerate ? 'moderate' : isLow ? 'low' : 'minimal',
                categoriesMet
            };
        }

        // Calculate time level
        function calculateTimeLevel(visitType, time) {
            const thresholds = visitType === 'new' ? CONFIG.newPatientTimes : CONFIG.establishedPatientTimes;
            if (time >= thresholds[3]) return 4;
            if (time >= thresholds[2]) return 3;
            if (time >= thresholds[1]) return 2;
            if (time >= thresholds[0]) return 1;
            return 0;
        }

        // Calculate MDM level
        function calculateMDMLevel(problems, dataLevel, risk) {
            const levelMap = { 'minimal': 0, 'low': 1, 'moderate': 2, 'high': 3 };
            let elemNums = [levelMap[problems], levelMap[dataLevel], levelMap[risk]];
            elemNums.sort((a, b) => b - a);
            const mdmNumeric = elemNums[1] || 0;
            return {
                level: mdmNumeric + 1,
                description: CONFIG.levelDescriptions[mdmNumeric]
            };
        }

        function calculateLevel() {
            const visitType = document.getElementById('visitType').value;
            const problems = document.querySelector('input[name="problems"]:checked')?.value || 'minimal';
            const risk = document.querySelector('input[name="risk"]:checked')?.value || 'minimal';
            const timeValue = document.getElementById('time').value;
            const time = validateTime(timeValue);
            
            const data = calculateDataLevel();
            const mdm = calculateMDMLevel(problems, data.level, risk);
            const timeLevel = calculateTimeLevel(visitType, time);
            const finalLevel = Math.max(mdm.level, timeLevel);
            
            const codes = visitType === 'new' ? CONFIG.codes.new : CONFIG.codes.established;
            const code = codes[finalLevel];
            
            document.getElementById('result').innerHTML = `
                <strong>Suggested Level: ${finalLevel} (Code: ${code})</strong><br>
                MDM Breakdown:<br>
                - Problems: ${problems.charAt(0).toUpperCase() + problems.slice(1)}<br>
                - Data: ${data.level.charAt(0).toUpperCase() + data.level.slice(1)} (Categories met: ${data.categoriesMet})<br>
                - Risk: ${risk.charAt(0).toUpperCase() + risk.slice(1)}<br>
                Use the higher of MDM (Level ${mdm.level} - ${mdm.description}) or Time (Level ${timeLevel}).
            `;
            
            // Hide step5 and show result and reset button
            document.getElementById('step5').classList.remove('active');
            document.getElementById('result').style.display = 'block';
            document.getElementById('resetButton').style.display = 'block';
        }

        // Reset form function
        function resetForm() {
            document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => input.checked = false);
            document.getElementById('time').value = '';
            document.getElementById('result').innerHTML = '';
            document.getElementById('result').style.display = 'none';
            document.getElementById('resetButton').style.display = 'none';
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.getElementById('step1').classList.add('active');
            document.getElementById('next2').disabled = true;
            document.getElementById('next4').disabled = true;
            showError('problems-error', false);
            showError('risk-error', false);
            showError('time-error', false);
        }

        // Screen reader only class
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </script>
</body>
</html>